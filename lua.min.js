(function(){function D(d){return z[/\.\/(\w*)\.js/.exec(d)[1]]}var z={lex:{},parser:{},codegen:{},types:{},index:{}};(function(d){function c(c){return e.test(c)}function u(e){return"\n"==e||"\r"==e}function g(e,c,g){var k=0,d=e();if("["!=d&&"]"!=d)throw"Lexical internal error!";g&&g(d);for(c();"="==e();)c(),g&&g(e()),++k;return e()==d?k:-k-1}function k(e,c){var g=e();c();u(e())&&e()!=g&&c()}function l(e,c,d){function h(e){l.push(e)}var l=[];c();for(u(e())&&k(e,c);;){var m=e();switch(m){case null:throw"unfinished long string/comment";
case "]":if(g(e,c,h)==d)return c(),l.splice(-d-1,d+1),l.join("");break;case "\n":case "\r":k(e,c);h("\n");break;default:h(m),c()}}}function h(e,v){for(;;)switch(e()){case "\n":case "\r":case " ":case "\f":case "\t":case "\v":v();break;case "-":v();if("-"!=e())return"-";v();var d=e();if("["==d){var h=g(e,v);if(0<=h){l(e,v,h);break}}for(;d&&"\n"!=d&&"\r"!=d;)v(),d=e();break;case "[":h=g(e,v);if(0<=h)return{id:w.TK_STRING,val:l(e,v,h)};if(-1==h)return"[";throw"invalid long string delimiter";case "=":v();
if("="!=e())return"=";v();return w.TK_EQ;case "<":v();if("="!=e())return"<";v();return w.TK_LE;case ">":v();if("="!=e())return">";v();return w.TK_GE;case "~":v();if("="!=e())return"~";v();return w.TK_NE;case ":":v();if(":"!=e())return":";v(ls);return w.TK_DBCOLON;case '"':case "'":var d=w.TK_STRING,h=e,n=v,x=[],A=h();n();for(var u=void 0;(u=h())!=A;)switch(u){case null:throw"unfinished string";case "\n":case "\r":throw"unfinished string";case "\\":n();u=h();switch(u){case "b":x.push("\b");n();break;
case "f":x.push("\f");n();break;case "n":x.push("\n");n();break;case "r":x.push("\r");n();break;case "t":x.push("\t");n();break;case "v":x.push("\v");n();break;case "\n":case "\r":x.push("\n");k();break;case "\\":case '"':case "'":x.push(u);n();break;case null:throw"unfinished string";case "z":for(n();lisspace(h());)n();break;case "x":throw"esacpe for char code not supported in lua.js yet.";default:if(!m.test(u))throw"invalid escape sequence"+u;throw"esacpe for char code not supported in lua.js yet.";
}break;default:x.push(u),n()}n();h=x.join("");return{id:d,val:h};case ".":v();if("."==e())return v(),"."==e()?(v(),w.TK_DOTS):w.TK_CONCAT;d=e();if(!m.test(d))return".";case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":d=w.TK_NUMBER;h=e;n=v;x=h();n();if("0"!=x||"x"!=h()&&"X"!=h()){x=[x];for(A=h();m.test(A)||"."==A;)x.push(A),n(),A=h();h=parseFloat(x.join(""))}else throw n(),Error("Hexadecimal numeric not supported in lua.js yet.");return{id:d,val:h};case null:return w.TK_EOS;
default:d=e();if(B.test(d)){d=e;h=v;for(n=[];c(d());)n.push(d()),h();d=n.join("");return(h="number"==typeof r[d]&&r[d])?h:{id:w.TK_NAME,val:d}}d=e();v();return d}}function n(e){function c(){return d<e.length?e.charAt(d):null}function g(){d<e.length&&++d}var d=0;return function(){return h(c,g)}}d.tokens="<eof> and break do else elseif end false for function goto if in local nil not or repeat return then true until while .. ... == >= <= ~= :: <--orgion-eof> <number> <name> <string> __javascript __jsreturn".split(" ");
var r={and:1,"break":2,"do":3,"else":4,elseif:5,end:6,"false":7,"for":8,"function":9,"goto":10,"if":11,"in":12,local:13,nil:14,not:15,or:16,repeat:17,"return":18,then:19,"true":20,until:21,"while":22,__javascript:34,__js:34,__jsreturn:35},w={TK_EOS:0,TK_AND:1,TK_BREAK:2,TK_DO:3,TK_ELSE:4,TK_ELSEIF:5,TK_END:6,TK_FALSE:7,TK_FOR:8,TK_FUNCTION:9,TK_GOTO:10,TK_IF:11,TK_IN:12,TK_LOCAL:13,TK_NIL:14,TK_NOT:15,TK_OR:16,TK_REPEAT:17,TK_RETURN:18,TK_THEN:19,TK_TRUE:20,TK_UNTIL:21,TK_WHILE:22,TK_CONCAT:23,TK_DOTS:24,
TK_EQ:25,TK_GE:26,TK_LE:27,TK_NE:28,TK_DBCOLON:29,TK_NUMBER:31,TK_NAME:32,TK_STRING:33,TK_JAVASCRIPT:34,TK_JSRETURN:35};d.TK=w;var B=/^[A-Za-z\_]$/,m=/^[0-9]$/,e=/^[0-9A-Za-z\_]$/;d.generator=n;d.lex=function(e){var c=n(e),g=c(),d=c();return{curr:function(){return g},lookAhead:function(){return d},next:function(){g=d;d=c()}}}})(z.lex);(function(d){function c(e){switch(typeof e){case "string":case "number":return e;case "object":return e.id}}function u(e){return"number"==typeof e?F[e]:"object"==typeof e?
F[e.id]:e}function g(e){l(e,q.TK_NAME);var c=e.curr().val;e.next();return{type:"variable",val:c}}function k(e,g){if(c(e.curr())==g)return e.next(),!0}function l(e,g){if(c(e.curr())!=g)throw Error("symbol "+u(g)+" expected!");}function h(e,c){l(e,c);e.next()}function n(e){l(e,q.TK_NAME);var c=e.curr().val;e.next();return c}function r(e){return{type:"const.string",val:n(e)}}function w(e){l(e,q.TK_STRING);var c=e.curr().val;e.next();return{type:"const.string",val:c}}function B(e){e.next();var c=y(e,
0);h(e,"]");return c}function m(e){switch(c(e.curr())){case "(":e.next();if(")"==e.curr())return e.next(),[];var g=E(e);h(e,")");return g;case "{":return[x(e)];case q.TK_STRING:return[w(e)];default:throw Error("function arguments expected, got "+u(e.curr()));}}function e(e){var p;a:switch(p=c(e.curr()),p){case "(":e.next();p=y(e,0);h(e,")");p={type:"expr.brackets",expr:p};break a;case q.TK_NAME:p=g(e);break a;case q.TK_JAVASCRIPT:e.next();p={type:"expr.javascript",args:m(e)};break a;default:throw Error("unexpected symbol "+
(F[p]||p));}for(;;)switch(c(e.curr())){case ".":e.next();var d=r(e);p={type:"expr.index",self:p,key:d};break;case "[":d=B(e);p={type:"expr.index",self:p,key:d};break;case ":":e.next();var d=r(e),v=m(e);p={type:"expr.callMethod",self:p,key:d,args:v};break;case "(":case "{":case q.TK_STRING:v=m(e);p={type:"expr.call",func:p,args:v};break;default:return p}}function p(e){switch(e.curr()){case "+":return 1;case "-":return 2;case "*":return 3;case "/":return 4;case "%":return 5;case "^":return 6;case q.TK_CONCAT:return 7;
case q.TK_EQ:return 8;case "<":return 9;case q.TK_LE:return 10;case q.TK_NE:return 11;case ">":return 12;case q.TK_GE:return 13;case q.TK_AND:return 14;case q.TK_OR:return 15}}function v(g){switch(c(g.curr())){case q.TK_NUMBER:var p=g.curr().val;g.next();return{type:"const.number",val:p};case q.TK_STRING:return w(g);case q.TK_NIL:return g.next(),{type:"const.nil"};case q.TK_TRUE:return g.next(),{type:"const.boolean",val:!0};case q.TK_FALSE:return g.next(),{type:"const.boolean",val:!1};case q.TK_DOTS:return g.next(),
{type:"vararg"};case "{":return x(g);case q.TK_FUNCTION:return g.next(),z(g);default:return e(g)}}function y(e,c){var g,d;a:{switch(e.curr()){case q.TK_NOT:d="uop.not";break a;case "-":d="uop.minus";break a;case "#":d="uop.len";break a}d=void 0}d?(e.next(),g=y(e,M),g={type:"expr.uop",op:d,operand:g}):g=v(e);for(d=p(e);d&&J[d][0]>c;){e.next();var h=y(e,J[d][1]);g={type:"expr.op",op:K[d],left:g,right:h};d=p(e)}return g}function E(e){var c=[];for(c.push(y(e,0));k(e,",");)c.push(y(e,0));return c}function H(e){var g;
g=c(e.curr())==q.TK_NAME?r(e):B(e);h(e,"=");return{type:"field.rec",key:g,val:y(e,0)}}function x(e){h(e,"{");var g=[];do{if("}"==e.curr())break;var p;a:{p=e;var d=p.curr();switch(c(d)){case q.TK_NAME:p="="!=p.lookAhead()?{type:"field.list",val:y(p,0)}:H(p);break a;case "[":p=H(p);break a;default:p={type:"field.list",val:y(p,0)}}}p&&g.push(p)}while(k(e,",")||k(e,";"));h(e,"}");return{type:"expr.constructor",fields:g}}function A(e,c){var g={type:c?"stat.jsreturn":"stat.return",nret:[]};e.next();L(e)||
";"==e.curr()||(g.nret=E(e));for(;k(e,";"););return g}function I(c){switch(c.curr()){case ";":c.next();break;case q.TK_IF:var p={type:"stat.if"},d=p;c.next();var v=d;v.cond=y(c,0);h(c,q.TK_THEN);for(v.tblock=C(c);k(c,q.TK_ELSEIF);){d.fblock={type:"block",stats:[{type:"stat.if"}]};var d=d.fblock.stats[0],v=c,l=d;l.cond=y(v,0);h(v,q.TK_THEN);l.tblock=C(v)}k(c,q.TK_ELSE)&&(d.fblock=C(c));h(c,q.TK_END);return p;case q.TK_WHILE:return c.next(),p=y(c,0),h(c,q.TK_DO),d=C(c),h(c,q.TK_END),{type:"stat.while",
cond:p,block:d};case q.TK_DO:return c.next(),p=C(c),h(c,q.TK_END),p;case q.TK_FOR:c.next();d=n(c);switch(c.curr()){case "=":c.next();v=y(c,0);h(c,",");l=y(c,0);k(c,",")&&(p=y(c,0));p={type:"stat.fornum",varname:d,from:v,to:l,step:p};break;case ",":case q.TK_IN:for(p=[d];k(c,",");)p.push(n(c));h(c,q.TK_IN);p={type:"stat.forlist",varnames:p,explist:E(c)};break;default:throw"`=` or `in` expected";}h(c,q.TK_DO);p.block=C(c);h(c,q.TK_END);return p;case q.TK_REPEAT:return c.next(),p=C(c),h(c,q.TK_UNTIL),
{type:"stat.repeat",until:y(c,0),block:p};case q.TK_FUNCTION:c.next();for(p=g(c);k(c,".");)d=r(c),p={type:"expr.index",self:p,key:d};k(c,":")?(d=r(c),p={type:"stat.method",self:p,key:d}):p={type:"stat.function",left:p};p.func=z(c);return p;case q.TK_LOCAL:c.next();if(k(c,q.TK_FUNCTION))return{type:"stat.localfunction",name:n(c),func:z(c)};p=[];do p.push(n(c));while(k(c,","));k(c,"=")&&(d=E(c));return{type:"stat.local",names:p,right:d};case q.TK_RETURN:return A(c);case q.TK_JSRETURN:return A(c,!0);
case q.TK_BREAK:return c.next(),{type:"stat.break"};default:p=e(c);if("="==c.curr()||","==c.curr()){for(p=[p];k(c,",");)p.push(e(c));h(c,"=");c={type:"stat.assignment",lefts:p,right:E(c)}}else{if("expr.call"!=p.type&&"expr.callMethod"!=p.type&&"expr.javascript"!=p.type)throw Error("syntax error, unexpected expr type "+p.type);c={type:"stat.expr",expr:p}}return c}}function L(e){switch(e.curr()){case q.TK_ELSE:case q.TK_ELSEIF:case q.TK_END:case q.TK_EOS:case q.TK_UNTIL:return!0;default:return 0}}function C(e){for(var c=
[];!L(e);){if(e.curr()==q.TK_RETURN||e.curr()==q.TK_JSRETURN){c.push(I(e));break}var g=I(e);g&&c.push(g)}return{type:"block",stats:c}}function z(e){h(e,"(");var g=[];if(")"!=e.curr()){do switch(c(e.curr())){case q.TK_NAME:g.push(n(e));break;case q.TK_DOTS:g.push(q.TK_DOTS);e.next();break;default:throw"<name> or `...` expected";}while(k(e,","))}var p=!1;0<g.length&&g[g.length-1]==q.TK_DOTS&&(g.pop(),p=!0);h(e,")");var d=C(e);h(e,q.TK_END);return{type:"function",args:g,varargs:p,block:d}}var G=D("./lex.js"),
N=G.lex,q=G.TK,F=G.tokens,J=[null,[6,6],[6,6],[7,7],[7,7],[7,7],[10,9],[5,4],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[2,2],[1,1]],K=[null,"op.add","op.minus","op.mul","op.div","op.mod","op.pow","op.concat","op.equal","op.less","op.lessequal","op.notequal","op.great","op.greatequal","op.and","op.or"];d.opname=K;var M=8;d.main=function(e){var c={type:"function",args:[],varargs:!0,block:C(e)};l(e,q.TK_EOS);return c};d.parse=function(e){return d.main(N(e))}})(z.parser);(function(d){function c(e){return"const.number"==
e.type?l(e):"l.__checknumber("+g(e)+")"}function u(e){if("vararg"==e.type||"expr.call"==e.type||"expr.callMethod"==e.type)return!0}function g(e){return u(e)?"("+l(e)+")[0]":l(e)}function k(e){if(e.length&&u(e[e.length-1])){if(1==e.length)return l(e[0]);for(var c=[],d=0;d<e.length-1;d++)c.push(g(e[d]));return"["+c.join(",")+"].concat("+l(e[e.length-1])+")"}c=[];for(d=0;d<e.length;d++)c.push(g(e[d]));return"["+c.join(",")+"]"}function l(e){if(n[e.type])return n[e.type](e);throw Error("Unsupported ast type "+
e.type);}function h(e,c){return function(g){function d(g,v){if(g&&g.constructor==Array){for(var h=0;h<g.length;h++)g[h]=d(g[h],v);return g}if(g&&g.type){var k=e(g,v)||g,l=m[k.type];if(l)for(h=0;h<l.length;h++)k[l[h]]=d(k[l[h]],k);c&&(k=c(k,v)||k);return k}}return d(g)}}var n={},r,w,B;r="\n";w=function(){r+="    "};B=function(){r=r.substr(0,r.length-4)};n["function"]=function(e){return"l._f(function("+e.args.join(",")+")"+l(e.block)+")"};n.block=function(e){var c=[];w();for(var g=0;g<e.stats.length;g++)c.push(l(e.stats[g]));
B();return r+"{"+c.join("")+r+"}"};n["stat.getvaargs"]=function(e){return r+"var __VA_ARG = Array.prototype.slice.call(arguments, "+e.argCount+");"};n["stat.expr"]=function(e){return r+l(e.expr)+";"};n["stat.local"]=function(e){if(e.right){if(1==e.names.length)return r+"var "+e.names[0]+" = "+g(e.right[0])+";";for(var c=[],d=0;d<e.names.length;d++)c.push(e.names[d]+" = t["+d+"]");return r+"var t ="+k(e.right)+","+r+c.join(",")+";"}return r+"var "+e.names.join(",")+";"};n["stat.if"]=function(e){var c=
r+"if ("+g(e.cond)+")"+l(e.tblock);return e.fblock&&0<e.fblock.stats.length?1==e.fblock.stats.length&&"stat.if"==e.fblock.stats[0].type?c+"else"+l(e.fblock.stats[0]):c+"else"+l(e.fblock):c};n["stat.fornum"]=function(e){if(e.step){w();var g=r+e.varname+" = "+e.$var+";"+l(e.block)+r+e.$var+" += "+e.$step;B();return r+"var "+e.$var+" = "+c(e.from)+", "+e.$limit+" = "+c(e.to)+", "+e.$step+" = "+c(e.step)+","+e.varname+";"+r+"while (("+e.$step+">0 && "+e.$var+"<="+e.$limit+") || ("+e.$step+"<0 && "+e.$var+
">="+e.$limit+")){"+g+r+"}"}return r+"for (var "+e.varname+", "+e.$var+" = "+c(e.from)+", "+e.$limit+" = "+c(e.to)+";("+e.varname+"="+e.$var+")<="+e.$limit+";++"+e.$var+")"+l(e.block)};n["stat.forlist"]=function(e){w();var c=e.$st,g=[];g.push(r+"var t = "+c+"[0]("+c+"[1],"+c+"[2]);");for(var d=0;d<e.varnames.length;++d)g.push(r+"var "+e.varnames[d]+" = t["+d+"];");g.push(r+"if ("+e.varnames[0]+" == null) break;");g.push(r+c+"[2] = "+e.varnames[0]+";");g.push(l(e.block));B();return r+"var "+c+" = "+
k(e.explist)+";"+r+"for (;;)"+r+"{"+g.join("")+r+"}"};n["stat.while"]=function(e){return r+"while ("+g(e.cond)+")"+l(e.block)};n["stat.repeat"]=function(e){return r+"do "+l(e.block)+"while (!("+g(e.until)+"));"};n["stat.break"]=function(e){return r+"break;"};n.vararg=function(e){return"__VA_ARG"};n["stat.return"]=function(e){var c=e.nret;if(c.length&&u(c[c.length-1]))return r+"return "+k(e.nret);for(var c=[],d=0;d<e.nret.length;d++)c.push(g(e.nret[d]));return r+"return ["+c+"];"};n["stat.jsreturn"]=
function(e){return r+"return "+g(e.nret)};n["stat.assignment"]=function(e){if(1==e.lefts.length){var c=1==e.right.length?g(e.right[0]):k(e.right)+"[0]";if("expr.index"==e.lefts[0].type){var d=e.lefts[0];return r+"l.__set("+g(d.self)+", "+l(d.key)+", "+c+");"}return r+l(e.lefts[0])+" = "+c+";"}c=[];c.push(r+"var t = "+k(e.right)+";");for(var h=0;h<e.lefts.length;++h)"expr.index"==e.lefts[h].type?(d=e.lefts[h],c.push(r+"l.__set("+g(d.self)+","+l(d.key)+",t["+h+"]);")):c.push(r+l(e.lefts[h])+" = t["+
h+"];");return c.join("")};n["expr.index"]=function(e){return"l.__get("+g(e.self)+","+l(e.key)+")"};n["expr.op"]=function(e){var c,d;switch(e.op){case "op.add":c="l.__add";break;case "op.minus":c="l.__sub";break;case "op.mul":c="l.__mul";break;case "op.div":c="l.__div";break;case "op.mod":c="l.__mod";break;case "op.pow":c="l.__pow";break;case "op.concat":c="l.__concat";break;case "op.equal":c="l.__eq";break;case "op.less":c="l.__lt";break;case "op.lessequal":c="l.__le";break;case "op.notequal":c=
"l.__neq";break;case "op.great":c="l.__gt";break;case "op.greatequal":c="l.__ge";break;case "op.and":d="&&";break;case "op.or":d="||";break;default:throw Error(e.op+" is not implemented yet.");}if(d)return g(e.left)+d+g(e.right);if(c)return c+"("+g(e.left)+","+g(e.right)+")"};n["expr.uop"]=function(e){switch(e.op){case "uop.minus":return"l.__unm("+g(e.operand)+")";case "uop.not":return"!("+g(e.operand)+")";case "uop.len":return"l.__len("+g(e.operand)+")";default:throw Error(e.op+" is not implemented yet.");
}};n["expr.call"]=function(e){return"l.__call("+g(e.func)+","+k(e.args)+")"};n["expr.callMethod"]=function(e){return"l.__callMethod("+g(e.self)+","+g(e.key)+","+k(e.args)+")"};n["expr.brackets"]=function(e){return u(e.expr)?g(e.expr):"("+l(e.expr)+")"};n["expr.constructor"]=function(e){if(!e.fields.length)return"l.__newTable()";for(var c=[],d=0;d<e.fields.length;d++){var h=e.fields[d];if("field.list"==h.type)u(h.val)&&d==e.fields.length-1?c.push("[2, "+l(h.val)+"]"):c.push("[0, "+g(h.val)+"]");else if("field.rec"==
h.type)c.push("[1, "+l(h.key)+","+g(h.val)+"]");else throw Error("Invalid field type "+h.type);}return"l.__newTable(["+c.join(",")+"])"};n.variable=function(e){return e.val};n["const.string"]=function(e){return e.val?JSON.stringify(e.val):"l.ds"};n["const.number"]=function(e){return e.val?JSON.stringify(e.val):"l.d0"};n["const.boolean"]=function(e){return JSON.stringify(e.val)};n["const.nil"]=function(e){return"null"};n["expr.javascript"]=function(e){if(1!=e.args.length)throw Error("__javascript should have exactly one arguments.");
return"const.string"==e.args[0].type?"("+e.args[0].val+")":"eval("+g(e.args[0])+")"};var m={"expr.uop":["operand"],"expr.op":["left","right"],"stat.assignment":["lefts","right"],"stat.expr":["expr"],"field.list":["val"],"field.rec":["key","val"],"expr.constructor":["fields","recs","list"],"stat.if":["cond","tblock","fblock"],"stat.fornum":["from","to","step","block"],"stat.forlist":["explist","block"],"stat.while":["cond","block"],"stat.repeat":["until","block"],"expr.index":["self","key"],"expr.callMethod":["self",
"key","args"],"expr.call":["func","args"],"expr.brackets":["expr"],"stat.method":["self","key","func"],"stat.function":["left","func"],"stat.localfunction":["func"],"stat.local":["right"],"stat.return":["nret"],"function":["block"],block:["stats"]};d.traverse=h;d.phases=[];d.postphases=[];d.run=function(e){for(var c=0;c<d.phases.length;c++)e=d.phases[c](e);e=l(e);for(c=0;c<d.postphases.length;c++)e=d.postphases[c](e);return e};(function(){d.phases.push(h(function(e){switch(e.type){case "function":e.varargs&&
e.block.stats.unshift({type:"stat.getvaargs",argCount:e.args.length});e=e.block.stats;0!=e.length&&"stat.return"==e[e.length-1].type||e.push({type:"stat.return",nret:[]});break;case "block":for(var c=[],g=0;g<e.stats.length;g++){var d=e.stats[g];switch(d.type){case "stat.localfunction":c.push({type:"stat.local",names:[d.name]});c.push({type:"stat.assignment",lefts:[{type:"variable",val:d.name}],right:[d.func]});break;case "stat.function":c.push({type:"stat.assignment",lefts:[d.left],right:[d.func]});
break;case "stat.method":d.func.args.unshift("self");c.push({type:"stat.assignment",lefts:[{type:"expr.index",self:d.self,key:d.key}],right:[d.func]});break;default:c.push(e.stats[g])}}e.stats=c}}))})();(function(){d.phases.push(function(e){var c=[],g,d={},k=0;return e=h(function(e){var h;switch(e.type){case "block":h=[];break;case "function":h=e.args;break;case "stat.fornum":h=[e.varname,"$var","$limit","$step"];break;case "stat.forlist":h=e.varnames;h.push("$st");break;case "variable":if(d[e.val]){var l;
h=d[e.val];"fornum"==g.curr.type||"forlist"==g.curr.type?h[h.length-1]!=g.curr?l=h[h.length-1]:1<h.length&&(l=h[h.length-2]):l=h[h.length-1];if(l){e.val=e.val+"$"+l.id;return}}return"_ENV"==e.val?void 0:{type:"expr.index",self:{type:"variable",val:"_ENV"},key:{type:"const.string",val:e.val}}}if(h){g&&c.push(g);g={curr:e,names:h.slice(0)};for(l=0;l<h.length;l++){var n=h[l];d[n]=d[n]||[];var m=++k;h[l]=n+"$"+m;d[n].push({id:m,curr:e})}"stat.fornum"==e.type?(e.varname=h[0],e.$var=h[1],e.$limit=h[2],
e.$step=h[3]):"stat.forlist"==e.type&&(e.$st=h.pop())}},function(e){if(g&&g.curr==e){for(var h=0;h<g.names.length;h++){var l=g.names[h];d[l].pop();0==d[l].length&&delete d[l]}g=c.pop()}else if("stat.local"==e.type)for(h=0;h<e.names.length;h++){l=e.names[h];d[l]=d[l]||[];var n=d[l];if(0<n.length&&n[n.length-1]===g){var m=n[n.length-1].id=++k;e.names[h]=l+"$"+m}else m=++k,e.names[h]=l+"$"+m,n.push({id:m,curr:g.curr}),g.names.push(l)}})(e)})})();d.sign="/*lua.js generated code*/";(function(){d.postphases.push(function(e){return"/*lua.js generated code*/return "+
e+";"})})()})(z.codegen);(function(d){function c(){this._hashKey=-2;this.toString=function(){return""}}function u(c){this.stringMap={};this.array=[];this.hashMap={};this.metatable=null;this._hashKey=++l;if(c)for(var g=0;g<c.length;g++){var d=c[g];if(0==d[0])this.array.push(d[1]);else if(1==d[0])this.set(d[1],d[2]);else for(var k=0;k<d[1].length;k++)this.array.push(d[1][k])}}var g={_hashKey:-1,valueOf:function(){return 0},toString:function(){return"0"}};c.prototype=String.prototype;var k=new c;d.dummy0=
g;d.dummyStr=k;var l=0;d.LuaTable=u;d.newHashKey=function(){return++l};u.prototype={};u.prototype.constructor=u;u.prototype.get=function(c){switch(typeof c){case "number":return this.array[c-1];case "string":return this.stringMap[c];case "object":if(c===g)return this.array[-1];if(c===k)return this.stringMap[c];if(null===c)throw Error("table index is nil");case "function":return c._hashKey||(c._hashKey=++l),(c=this.hashMap[c._hashKey])&&c[1];default:throw Error("get with a invalid argument"+c);}};
u.prototype.set=function(c,g){if(null==c)throw Error("table index is nil");if(null==g)switch(typeof c){case "number":c==this.array.length?this.array.pop():delete this.array[c-1];break;case "string":delete this.stringMap[c];break;case "object":case "function":if(!c._hashKey)break;delete this.hashMap[c._hashKey];break;default:throw Error("set with a invalid argument"+c);}else switch(typeof c){case "number":this.array[c-1]=g;break;case "string":this.stringMap[c]=g;break;case "object":case "function":c._hashKey||
(c._hashKey=++l);this.hashMap[c._hashKey]=[c,g];break;default:throw Error("set with a invalid argument"+c);}};u.prototype.length=function(){for(var c=this.array.length;0<c&&null==this.array[c-1];--c);c!=this.array.length&&(this.array.length=c);return this.array.length};u.prototype.toString=function(){return"table "+this._hashKey}})(z.types);(function(d){function c(c){return c.substr(0,l.length)!=l?k.run(g.parse(c)):c}function u(){function g(e,c){var d=m.__getmetatable(e);return d&&d.stringMap&&d.stringMap[c]}
if(!(this instanceof u))return new u;var l=new h.LuaTable;this._G=l;l.set("_G",l);l.set("_VERSION","Lua 5.2");l.set("_LUAJS","Lua.js 0.1");var m={};m.d0=n;m.ds=r;m.__getmetatable=function(e){if(!e)return null;switch(typeof e){case "object":return e.metatable||(e instanceof h.LuaTable?null:m.jsObjMT);case "string":return m.stringMT;case "function":if(!f.__lua_function)return m.jsFuncMT;default:return null}};m._f=function(e){e.__lua_function=!0;return e};m.__get=function(e,c){var d;if(e instanceof h.LuaTable){if(d=
e.get(c))return d;d=g(e,"__index");if(!d)return null}else{if("object"==typeof e||"function"==typeof e&&!e.__lua_function){if("function"==typeof e)for(;e.__beforeBind;)e=e.__beforeBind;d="number"==typeof c?e[c-1]:e[c];if("function"==typeof d){var k=d.bind(e);k.__beforeBind=d;return k}if(!d&&"new"==c){var l=function(){};l.prototype=e.prototype;return function(){var e=new l;t.apply(e,arguments);return e}}return d}d=g(e,"__index");if(!d)throw Error("attempt to index a "+m.__type(e)+" value.");}return"function"==
typeof d?m.__call(d,[e,c])[0]:m.__get(d,c)};m.__set=function(e,c,d){var k;if(e instanceof h.LuaTable){if(e.get(c)){e.set(c,d);return}k=g(e,"__newindex");if(!k){e.set(c,d);return}}else{if("object"==typeof e||"function"==typeof e&&!e.__lua_function){e[c]=d;return}k=g(e,"__newindex");if(!k)throw Error("attempt to index a "+m.__type(e)+" value.");}"function"==typeof k?m.__call(k,[e,c,d]):m.__set(k,c,d)};m.__add=function(e,c){if("number"==typeof e&&"number"==typeof c)return e+c||n;var d=m.__tonumber(e),
k=m.__tonumber(c);if(d&&k)return e+c||n;if(d=g(e,"__add")||g(c,"__add"))return m.__call(d,[e,c])[0];throw Error("attempt to perform arithmetic on a "+m.__type(e)+" value");};m.__sub=function(e,c){if("number"==typeof e&&"number"==typeof c)return e-c||n;var d=m.__tonumber(e),k=m.__tonumber(c);if(d&&k)return e-c||n;if(d=g(e,"__sub")||g(c,"__sub"))return m.__call(d,[e,c])[0];throw Error("attempt to perform arithmetic on a "+m.__type(e)+" value");};m.__mul=function(e,c){if("number"==typeof e&&"number"==
typeof c)return e*c||n;var d=m.__tonumber(e),k=m.__tonumber(c);if(d&&k)return e*c||n;if(d=g(e,"__mul")||g(c,"__mul"))return m.__call(d,[e,c])[0];throw Error("attempt to perform arithmetic on a "+m.__type(e)+" value");};m.__div=function(e,c){if("number"==typeof e&&"number"==typeof c)return e/c||n;var d=m.__tonumber(e),k=m.__tonumber(c);if(d&&k)return e/c||n;if(d=g(e,"__div")||g(c,"__div"))return m.__call(d,[e,c])[0];throw Error("attempt to perform arithmetic on a "+m.__type(e)+" value");};m.__mod=
function(e,c){if("number"==typeof e&&"number"==typeof c)return e%c||n;var d=m.__tonumber(e),k=m.__tonumber(c);if(d&&k)return e%c||n;if(d=g(e,"__mod")||g(c,"__mod"))return m.__call(d,[e,c])[0];throw Error("attempt to perform arithmetic on a "+m.__type(e)+" value");};m.__pow=function(e,c){if("number"==typeof e&&"number"==typeof c)return Math.pow(e,c)||n;var d=m.__tonumber(e),k=m.__tonumber(c);if(d&&k)return Math.pow(e,c)||n;if(d=g(e,"__pow")||g(c,"__pow"))return m.__call(d,[e,c])[0];throw Error("attempt to perform arithmetic on a "+
m.__type(e)+" value");};m.__unm=function(e){var c=m.__tonumber(e);if(c)return-c;if(c=g(e).__unm)return m.__call(c,[e])[0];throw Error("attempt to perform arithmetic on a "+m.__type(e)+" value");};m.__eq=function(e,c){return!m.__neq(e,c)};m.__neq=function(e,c){if(e===c)return!1;var d=m.__type(e),k=m.__type(c);if(d!=k||"table"!=d&&"userdata"!=d)return!0;d=g(e,"__eq");k=g(c,"__eq");return d&&d==k?!m.__call(d,[e,c])[0]:!0};m.__gt=function(e,c){return m.__lt(c,e)};m.__ge=function(e,c){return m.__le(c,
e)};m.__lt=function(e,c){var d=m.__type(e),k=m.__type(c);if("number"==d&&"number"==k||"string"==d&&"string"==k)return e<c;if(g(e,"__lt")||g(e,"__lt"))return!!m.__call(h1,[e,c])[0];throw Error("attempt to compare "+m.__type(e)+" with "+m.__type(c));};m.__le=function(c,d){var k=m.__type(c),h=m.__type(d);if("number"==k&&"number"==h||"string"==k&&"string"==h)return c<=d;if(k=g(c,"__le")||g(c,"__le"))return!!m.__call(h1,[c,d])[0];if(k=g(c,"__lt")||g(c,"__lt"))return!m.__call(h1,[c,d])[0];throw Error("attempt to compare "+
m.__type(c)+" with "+m.__type(d));};m.__concat=function(c,d){var k=m.__type(c),h=m.__type(d);if(!("number"!=k&&"string"!=k||"number"!=h&&"string"!=h))return""+c+d||r;if(g(c,"__concat")||g(d,"__concat"))return m.__call(h1,[c,d])[0];throw Error("attempt to concatenate a "+m.__type(c)+" value");};m.__newTable=function(c){return new h.LuaTable(c)};m.__len=function(c){switch(typeof c){case "string":return c.length}var d=g(c,"__len");if(d)return m.__call(d,[a])[0];if(c instanceof h.LuaTable)return c.length();
if("object"==typeof c&&c.length)return c.length;throw Error("attempt to get length of a "+m.__type(c)+" value");};m.__tonumber=function(c){switch(typeof c){case "number":return c;case "string":return parseInt(s)||n;default:if(c==n)return c}return null};m.__checknumber=function(c){switch(typeof c){case "number":return c;case "string":return parseInt(s)}if(c==n)return c;throw Error("Not a number.");};m.__tostring=function(c){if(null==c)return"nil";switch(typeof c){case "number":case "boolean":return c.toString();
case "string":return c;case "function":return c._hashKey=c._hashKey||h.newHashKey(),"function("+c._hashKey+")";case "object":if(c==n)return"0";if(c==r)return r;var d=g(c,"__tostring");if(d)return m.__call(d,[c])[0];if(c.toString)return c.toString();default:return"userdata("+c+")"}};m.__type=function(c){if(null==c)return"nil";var d=typeof c;switch(d){case "number":case "boolean":case "string":case "function":return d;case "object":if(c==n)return"number";if(c==r)return r;if(c instanceof h.LuaTable)return"table";
default:return"userdata"}};m.__call=function(c,d){if("function"==typeof c)return c.__lua_function?c.apply(null,d):[c.apply(null,d)];var k=g(c,"__call");if(k)return d.unshift(k),m.__call(k,d);throw Error("attempt to call a "+m.__type(c)+" value");};m.__callMethod=function(c,d,g){g.unshift(c);return m.__call(m.__get(c,d),g)};m.__dump=function(c){if("function"!=typeof c)throw Error("bad argument #1 to `dump` (function expected, got "+m.__type(c)+")");return k.sign+"return "+c.toString()+";"};this.loadString=
m.__loadString=function(e,d){e=c(e);return(new Function("_ENV","l",e))(d||l,m)};this.loadStdLib=function(){if(!d.stdlib){var c=D("fs"),g=D("path"),c=c.readFileSync(g.join(g.dirname(module.filename),"./stdlib.lua"),{encoding:"utf-8"});d.stdlib=new Function("_ENV","l",d.compile(c))}d.stdlib(l,m)()}}var g=D("./parser.js");d.parser=g;var k=D("./codegen.js");d.codegen=k;var l=k.sign;d.compile=c;var h=D("./types.js");d.types=h;var n=h.dummy0,r=h.dummyStr;u.prototype={};d.LuaContext=d.newContext=u})(z.index);
z.index.stdlib=function(d,c){return c._f(function(){Array.prototype.slice.call(arguments,0);c.__set(d,"assert",c._f(function(g,k){g||c.__call(c.__get(d,"error"),[k||"Assertion failed!"]);return[]}));c.__set(d,"collectgarbage",c._f(function(){return[]}));var u;u=c._f(function(g){c.__call(c.__get(d,"error"),["Not implemented"]);return[]});c.__set(d,"dofile",u);c.__set(d,"error",function(c){if("string"==typeof c)throw Error(c);throw c;});c.__set(d,"getmetatable",function(c){return c&&c.metatable});c.__set(d,
"ipairs",c._f(function(d){return[c._f(function(d,g){return c.__ge(g,c.__len(d))?[]:[c.__add(g,1),c.__get(d,c.__add(g,1))]}),d,c.d0]}));c.__set(d,"loadString",function(d,k){return c.__loadString(d,k)});c.__set(d,"load",c._f(function(g,k,l,h){if(c.__eq(c.__call(c.__get(d,"type"),[g])[0],"function")){k=c.__newTable();for(g=[g];;){l=g[0](g[1],g[2])[0];if(null==l)break;g[2]=l;c.__call(c.__get(c.__get(d,"table"),"insert"),[c.__get(d,"chunk"),l])}g=c.__call(c.__get(c.__get(d,"table"),"concat"),[k])[0]}return c.__call(c.__get(d,
"loadString"),[g,h])}));c.__set(d,"loadfile",u);c.__set(d,"next",u);c.__set(d,"pairs",u);c.__set(d,"pcall",c._f(function(d){var k=Array.prototype.slice.call(arguments,1);try{var l=c.__call(d,k);l.unshift(!0);return l}catch(h){return[!1,h]}}));c.__set(d,"print",c._f(function(){for(var g=Array.prototype.slice.call(arguments,0),g=c.__newTable([[2,g]]),k,l=1,h=c.__checknumber(c.__len(g));(k=l)<=h;++l)c.__set(g,k,c.__call(c.__get(d,"tostring"),[c.__get(g,k)])[0]);c.__call(c.__get(c.__get(d,"io"),"write"),
c.__call(c.__get(c.__get(d,"table"),"concat"),[g," "]));c.__call(c.__get(c.__get(d,"io"),"write"),["\n"]);return[]}));c.__set(d,"rawequal",function(c,d){return c===d});c.__set(d,"rawget",function(d,k){var l=c.__type(d);if("table"!=l)throw Error("rawget called with type "+l);return d.get(k)});c.__set(d,"rawlen",function(d){var k=c.__type(d);if("table"!=k)throw Error("rawlen called with type "+k);return d.length()});c.__set(d,"rawset",function(d,k,l){var h=c.__type(d);if("table"!=h)throw Error("rawget called with type "+
h);d.set(k,l);return d});c.__set(d,"select",function(c){return"#"==c?arguments.length:arguments[c]});c.__set(d,"setmetatable",function(c,d){if("object"!=typeof c)throw Error("Cannot set metatable to non-object values.");c.metatable=d});c.__set(d,"tonumber",c.__tonumber);c.__set(d,"tostring",c.__tostring);c.__set(d,"type",c.__type);c.__set(d,"xpcall",function(d,k){var l=Array.prototype.slice.call(arguments,2);try{return c.__call(d,l)}catch(h){return c.__call(k,[h])}});c.__set(d,"package",c.__newTable());
c.__set(c.__get(d,"package"),"loaded",c.__newTable());c.__set(c.__get(d,"package"),"preload",c.__newTable());c.__set(d,"require",c._f(function(g){var k=c.__get(c.__get(c.__get(d,"package"),"loaded"),g);if(k)return[k];for(var l,h,k=c.__call(c.__get(d,"ipairs"),[c.__get(c.__get(d,"package"),"searchers")]);;){var n=k[0](k[1],k[2]),r=n[0],n=n[1];if(null==r)break;k[2]=r;n=c.__call(n,[g]);l=n[0];h=n[1];if(l)break}l=c.__call(l,[g,h])[0];c.__set(c.__get(c.__get(d,"package"),"loaded"),g,c.__get(c.__get(c.__get(d,
"package"),"loaded"),g)||l);return[c.__get(c.__get(c.__get(d,"package"),"loaded"),g)]}));c.__set(d,"string",c.__newTable());c.stringMT=c.__get(d,"string");c.__set(c.__get(d,"string"),"byte",c._f(function(d,k,l){if("string"!=typeof d&&(d=c.__tostring(d),d==c.ds))return[];k=k||1;l=l||k;0>k?k=d.length+k:k--;0>l&&(l=d.length+l+1);for(var h=[];k<l;++k){var n=d.charCodeAt(k);n&&h.push(n)}return h}));c.__set(c.__get(d,"string"),"dump",c.__dump);c.__set(c.__get(d,"string"),"find",function(c,d,l,h){if(h)return c.indexOf(d,
l&&l-1)+1;throw Error("Not implemented.");});c.__set(c.__get(d,"string"),"len",function(d){"string"!=typeof d&&d!=c.ds&&(d=c.__tostring(d));return d==c.ds?0:d.length});c.__set(c.__get(d,"string"),"lower",function(d){"string"!=typeof d&&d!=c.ds&&(d=c.__tostring(d));return d==c.ds?d:d.toLowerCase()});c.__set(c.__get(d,"string"),"upper",function(d){"string"!=typeof d&&d!=c.ds&&(d=c.__tostring(d));return d==c.ds?d:d.toUpperCase()});c.__set(c.__get(d,"string"),"rep",function(c,d,l){return l?Array(d).join(c+
l)+c:Array(d+1).join(c)});c.__set(c.__get(d,"string"),"reverse",function(d){"string"!=typeof d&&d!=c.ds&&(d=c.__tostring(d));return d==c.ds?d:d.split("").reverse().join("")});c.__set(c.__get(d,"string"),"sub",function(d,k,l){"string"!=typeof d&&d!=c.ds&&(d=c.__tostring(d));if(d==c.ds)return[d];l=l||d.length;0>k?k=d.length+k:k--;0>l&&(l=d.length+l+1);return d.substring(d,k,l)});c.__set(d,"table",c.__newTable());c.__set(c.__get(d,"table"),"concat",function(c,d,l,h){c=c.array;l&&(c=h?c.slice(l-1,h-1):
c.slice(l-1));return c.join(d||"")});c.__set(c.__get(d,"table"),"insert",function(c,d,l){d?c.array.splice(d-1,0,l):c.array.push(l)});c.__set(c.__get(d,"table"),"pack",c._f(function(){var d=Array.prototype.slice.call(arguments,0);return[c.__newTable([[2,d]])]}));c.__set(d,"pack",c.__get(c.__get(d,"table"),"pack"));c.__set(c.__get(d,"table"),"remove",c._f(function(c,d){return d?c.array.splice(d-1,1):[c.array.pop()]}));c.__set(c.__get(d,"table"),"sort",function(d,k){k?d.array.sort(function(){return k(a,
b)[0]?-1:k(b,a)[0]?1:0}):d.array.sort(function(d,g){return c.__lt(d,g)?-1:c.__lt(g,d)?1:0})});c.__set(c.__get(d,"table"),"unpack",c._f(function(c){return c.array}));c.__set(d,"math",c.__newTable());c.__set(c.__get(d,"math"),"abs",Math.abs);c.__set(c.__get(d,"math"),"acos",Math.acos);c.__set(c.__get(d,"math"),"asin",Math.asin);c.__set(c.__get(d,"math"),"atan",Math.atan);c.__set(c.__get(d,"math"),"atan2",Math.atan2);c.__set(c.__get(d,"math"),"ceil",Math.ceil);c.__set(c.__get(d,"math"),"cos",Math.cos);
c.__set(c.__get(d,"math"),"cosh",Math.cosh);c.__set(c.__get(d,"math"),"deg",Math.deg);c.__set(c.__get(d,"math"),"exp",Math.exp);c.__set(c.__get(d,"math"),"floor",Math.floor);c.__set(c.__get(d,"math"),"pow",Math.pow);c.__set(c.__get(d,"math"),"sin",Math.sin);c.__set(c.__get(d,"math"),"sinh",Math.sinh);c.__set(c.__get(d,"math"),"sqrt",Math.sqrt);c.__set(c.__get(d,"math"),"tan",Math.tan);c.__set(c.__get(d,"math"),"tanh",Math.tanh);c.__set(c.__get(d,"math"),"pi",Math.PI);c.__set(c.__get(d,"math"),"log",
function(c,d){return d?Math.log(c)/Math.log(d):Math.log(c)});c.__set(c.__get(d,"math"),"max",function(){return Math.max.apply(null,arguments)});c.__set(c.__get(d,"math"),"min",function(c){return Math.min.apply(null,arguments)});c.__set(c.__get(d,"math"),"rad",function(c){return[c*Math.PI/180]});c.__set(c.__get(d,"math"),"random",function(c,d){return c?d?[Math.floor(Math.random()*(d-c+1))+c]:[Math.floor(Math.random()*c)+1]:[Math.random()]});c.__set(d,"bit32",c.__newTable());c.__set(c.__get(d,"bit32"),
"arshift",function(c,d){return c<<d});c.__set(c.__get(d,"bit32"),"band",function(c){for(var d=1;d<arguments.length;d++)c&=arguments[d];return c});c.__set(c.__get(d,"bit32"),"bnot",function(c){return~c});c.__set(c.__get(d,"bit32"),"bor",function(c){for(var d=1;d<arguments.length;d++)c|=arguments[d];return c});c.__set(c.__get(d,"bit32"),"btest",function(c){for(var d=1;d<arguments.length;d++)c&=arguments[d];return 0!=c});c.__set(c.__get(d,"bit32"),"bxor",function(c){for(var d=1;d<arguments.length;d++)c^=
arguments[d];return 0!=c});c.__set(d,"io",c.__newTable());c.__set(c.__get(d,"io"),"write",function(c){"\n"!=c&&console.log(c)});c.__set(c.__get(d,"io"),"flush",c._f(function(){return[]}));c.__set(d,"os",c.__newTable());c.__set(c.__get(d,"os"),"clock",function(){var c=Date.now();return function(){return(Date.now()-c)/1E3}}());c.__set(c.__get(d,"os"),"difftime",c._f(function(d,k){return[c.__sub(d,k)]}));c.__set(c.__get(d,"os"),"time",function(){return Date.now()/1E3});u=c.__newTable([[1,"__index",function(c,
d){var l=c[d];if("function"==typeof l)return function(c){var d=Array.prototype.slice.call(arguments,1);return l.apply(c,d)};if(!l&&"new"==d){var h=function(){};h.prototype=c.prototype;return function(){var d=new h;c.apply(d,arguments);return d}}return l}],[1,"__newindex",function(c,d,l){c[d]=l}]]);c.jsObjMT=u;c.jsFuncMT=u;return[]})};window.luajs=z.index;(function(){function d(c,d){var g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");g.addEventListener("readystatechange",
function(){if(4==g.readyState){if(200!=g.status&&0!=g.status)throw Error("HTTP "+g.status+": "+c);console.info("Loaded: ",c);d(g.responseText)}});g.open("GET",c,!0);g.send()}function c(k,l){l=l||0;if(!(l>=k.length)){var h=k[l];h.code?(g.loadString(h.code)("embedded"),c(k,l+1)):d(h.src,function(d){g.loadString(d)(h.src);c(k,l+1)})}}function u(){for(var d=window.document.getElementsByTagName("script"),g=[],h=0;h<d.length;h++){var n=d[h];if("text/lua"==n.type||"application/x-lua"==n.type)n.src?g.push({src:n.src}):
g.push({code:n.innerHTML})}c(g)}var g=luajs.newContext();g.loadStdLib();g._G.metatable=new luajs.types.LuaTable([[1,"__index",window]]);window.addEventListener?window.addEventListener("DOMContentLoaded",u,!1):window.attachEvent("onload",u)})()})();
